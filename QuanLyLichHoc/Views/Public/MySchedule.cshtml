@{
    ViewData["Title"] = "Lịch cá nhân";
}

<div class="container-fluid py-4">
    <div class="card shadow border-0 rounded-3">
        <div class="card-header bg-white py-3 d-flex justify-content-between align-items-center">
            <h5 class="fw-bold text-primary mb-0"><i class="bi bi-calendar-check me-2"></i>Lịch Trình Của Tôi</h5>

            @if (User.IsInRole("Student"))
            {
                <div class="alert alert-info py-1 px-3 mb-0 small">
                    <i class="bi bi-info-circle"></i> Bấm vào môn học để Check-in
                </div>
            }
        </div>
        <div class="card-body">
            <div id='calendar'></div>
        </div>
    </div>
</div>

<script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js'></script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        var calendarEl = document.getElementById('calendar');
        var calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'timeGridWeek',
            locale: 'vi',
            headerToolbar: {
                left: 'prev,next today',
                center: 'title',
                right: 'dayGridMonth,timeGridWeek,timeGridDay'
            },
            slotMinTime: '06:00:00',
            slotMaxTime: '20:00:00',
            allDaySlot: false,
            events: '/Public/GetMyEvents', // API lấy lịch

            eventClick: function(info) {
                // Logic khi bấm vào sự kiện
                @if (User.IsInRole("Student"))
                {
                        <text>
                        Swal.fire({
                            title: info.event.title,
                            html: `
                                <p><strong>GV:</strong> ${info.event.extendedProps.lecturer}</p>
                                <p><strong>Giờ:</strong> ${info.event.start.toLocaleTimeString()} - ${info.event.end.toLocaleTimeString()}</p>
                                <hr>
                                <a href="/Public/CheckIn?scheduleId=${info.event.id}" class="btn btn-warning fw-bold">📸 Gửi minh chứng (Check-in)</a>
                            `,
                            showConfirmButton: false,
                            showCloseButton: true
                        });
                        </text>
                }
                else
                {
                        <text>
                        Swal.fire({
                            title: info.event.title,
                            html: `Lớp: <strong>${info.event.extendedProps.className}</strong>`,
                            icon: 'info'
                        });
                        </text>
                }
            }
        });
        calendar.render();
    });
</script>

<style>
    #calendar {
        min-height: 700px;
        font-family: 'Segoe UI', sans-serif;
    }

    .fc-event {
        cursor: pointer;
        border-radius: 4px;
        border: none;
        font-size: 0.85rem;
        padding: 2px;
    }

    .fc-toolbar-title {
        font-size: 1.2rem !important;
        font-weight: bold;
        color: #4e73df;
    }

    .fc-col-header-cell {
        background-color: #f8f9fc;
        padding: 10px 0;
    }
</style>